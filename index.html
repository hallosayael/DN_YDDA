<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Debit Note Makan Siang (YDDA)</title>
<style>
body{font-family:Arial,Helvetica,sans-serif;background:#f8fafc;margin:0;padding:20px}
h1{margin:0;font-size:22px;text-align:center}
.container{max-width:1200px;margin:auto;background:#fff;padding:20px;border-radius:12px;box-shadow:0 3px 12px rgba(0,0,0,.08)}
.toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin:15px 0}
button{padding:6px 12px;border-radius:6px;border:1px solid #ccc;cursor:pointer;background:#fff}
button:hover{background:#f1f5f9}
input,select{padding:5px;border:1px solid #ccc;border-radius:6px}
table{width:100%;border-collapse:collapse;margin-top:10px;font-size:14px}
th,td{border:1px solid #ddd;padding:6px;text-align:right}
th:first-child,td:first-child{text-align:left}
tfoot td{font-weight:bold;background:#fefce8}
tfoot tr.net td{background:#fef08a}
input[type=number]{width:90px;text-align:right}
.add-col{background:#dbeafe;color:#1e3a8a;font-weight:bold}
</style>
</head>
<body>
<div class="container">
  <h1>Debit Note Makan Siang (YDDA)</h1>
  <div class="toolbar">
    <button id="addRow">+ Tambah Menu</button>
    <button id="addPerson">+ Tambah Nama</button>
    <button id="clearAll">ðŸ§¹ Bersihkan</button>
    <label>Basis Diskon:
      <select id="basis"><option>SUBTOTAL</option><option>TOTAL</option></select>
    </label>
  </div>

  <table id="tbl">
    <thead>
      <tr id="headerRow">
        <th>MENU</th>
        <th>ICHA</th><th>WISI</th><th>SARAH</th><th>MOLI</th><th>SANTI</th><th>ANGEL</th>
        <th class="col-total">TOTAL</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
    <tfoot>
      <tr id="rowSub"><td>SUBTOTAL (menu)</td></tr>
      <tr id="rowOngkir"><td>ONGKIR (TOTAL)</td></tr>
      <tr id="rowLain"><td>LAIN-LAIN (TOTAL)</td></tr>
      <tr id="rowTotal"><td>TOTAL</td></tr>
      <tr id="rowPct"><td>% (berdasar <span id="basisLabel">SUBTOTAL</span>)</td></tr>
      <tr id="rowDisc"><td>DISC (TOTAL)</td></tr>
      <tr class="net" id="rowNet"><td>NET = Total - Disc</td></tr>
    </tfoot>
  </table>
</div>

<script>
const fmt = n => n.toLocaleString('id-ID');
const parseNum = v => isNaN(+v)?0:+v;
let names = ["ICHA","WISI","SARAH","MOLI","SANTI","ANGEL"];
const tbody = document.getElementById("tbody");
const basisSel = document.getElementById("basis");
const basisLabel = document.getElementById("basisLabel");

function rebuildFooter(){
  const footRows = ["rowSub","rowOngkir","rowLain","rowTotal","rowPct","rowDisc","rowNet"];
  footRows.forEach(id=>{
    const tr=document.getElementById(id);
    tr.querySelectorAll("td:not(:first-child)").forEach(td=>td.remove());
    names.forEach((n,i)=>{
      const td=document.createElement("td"); td.id=`${id}_${i}`; tr.appendChild(td);
    });
    const tdTot=document.createElement("td");
    if(id==="rowOngkir"||id==="rowLain"||id==="rowDisc"){
      const inp=document.createElement("input"); inp.type="number"; inp.id=`${id}_total`; inp.oninput=calc;
      tdTot.appendChild(inp);
    } else tdTot.id=`${id}_total`;
    tr.appendChild(tdTot);
  });
}
function rebuildHeader(){
  const head=document.getElementById("headerRow");
  head.innerHTML='<th>MENU</th>'+names.map(n=>`<th>${n}</th>`).join("")+'<th class="col-total">TOTAL</th>';
}
function addRow(name=""){
  const tr=document.createElement("tr");
  tr.innerHTML=`<td><input type="text" placeholder="Nama menu" value="${name}"></td>`+
    names.map(()=>`<td><input type="number" min="0" step="1"></td>`).join("")+
    `<td class="total">0</td>`;
  tbody.appendChild(tr);
  calc();
}
function addPerson(){
  const nm=prompt("Masukkan nama orang baru:");
  if(!nm) return;
  names.push(nm.toUpperCase());
  rebuildHeader(); rebuildFooter();
  [...tbody.rows].forEach(tr=>{
    const td=document.createElement("td");
    const inp=document.createElement("input");
    inp.type="number"; inp.min=0; inp.step=1;
    inp.oninput=calc;
    td.appendChild(inp);
    tr.insertBefore(td,tr.lastElementChild);
  });
  calc();
}
function calc(){
  const rows=[...tbody.rows];
  const subtot=new Array(names.length).fill(0);
  rows.forEach(tr=>{
    const vals=[...tr.querySelectorAll('td input[type=number]')].map(i=>parseNum(i.value));
    const sum=vals.reduce((a,b)=>a+b,0);
    tr.querySelector(".total").textContent=fmt(sum);
    vals.forEach((v,i)=>subtot[i]+=v);
  });
  // Subtotal
  let subG=0;
  subtot.forEach((v,i)=>{document.getElementById(`rowSub_${i}`).textContent=fmt(v); subG+=v});
  document.getElementById("rowSub_total").textContent=fmt(subG);
  // Ongkir & Lain-lain
  const cnt=subtot.filter(v=>v>0).length||1;
  const ong=parseNum(document.getElementById("rowOngkir_total").querySelector("input")?.value||0);
  const lain=parseNum(document.getElementById("rowLain_total").querySelector("input")?.value||0);
  const ongEach=subtot.map(v=>v>0?ong/cnt:0);
  const lainEach=subtot.map(v=>v>0?lain/cnt:0);
  ongEach.forEach((v,i)=>document.getElementById(`rowOngkir_${i}`).textContent=fmt(v));
  lainEach.forEach((v,i)=>document.getElementById(`rowLain_${i}`).textContent=fmt(v));
  // Total
  const total=subtot.map((v,i)=>v+ongEach[i]+lainEach[i]);
  let totG=0;
  total.forEach((v,i)=>{document.getElementById(`rowTotal_${i}`).textContent=fmt(v); totG+=v});
  document.getElementById("rowTotal_total").textContent=fmt(totG);
  // Persentase
  const basis=basisSel.value.trim().toUpperCase();
  basisLabel.textContent=basis;
  const arr=(basis==="TOTAL"?total:subtot);
  const baseSum=arr.reduce((a,b)=>a+b,0);
  const pct=arr.map(v=>baseSum?v/baseSum:0);
  pct.forEach((p,i)=>document.getElementById(`rowPct_${i}`).textContent=(p*100).toFixed(2)+"%");
  // Diskon proporsional
  const disc=parseNum(document.getElementById("rowDisc_total").querySelector("input")?.value||0);
  const discEach=pct.map(p=>disc*p);
  discEach.forEach((v,i)=>document.getElementById(`rowDisc_${i}`).textContent=fmt(v));
  // Net
  const net=total.map((v,i)=>v-discEach[i]);
  let netG=0;
  net.forEach((v,i)=>{document.getElementById(`rowNet_${i}`).textContent=fmt(v); netG+=v});
  document.getElementById("rowNet_total").textContent=fmt(netG);
}
document.getElementById("addRow").onclick=()=>addRow();
document.getElementById("addPerson").onclick=addPerson;
document.getElementById("clearAll").onclick=()=>{[...document.querySelectorAll('input[type=number]')].forEach(i=>i.value='');calc();};
basisSel.onchange=calc;

// Init
rebuildFooter();
for(let i=0;i<10;i++) addRow();
calc();
</script>
</body>
</html>

